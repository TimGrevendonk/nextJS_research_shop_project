// link is used for client side navigation, the Link tag replaces the <a> tags.
import Link from "next/link";
import Head from 'next/head';
import Title from "../components/title";
import { useEffect, useState } from "react";
import { getProducts } from "../lib/products";

/* using api routes can reduce the size of data */


export default function HomePage() {
  // fetch data WHEN component is "mounted" like plain react component. 
  const [products, setProducts] = (
  // usestate hook returns parameter value in parentessis (empty array that binds to "products") and a function call (setProducts) to change the stata of "products".
    useState([]) 
  );
  // useEffect hook: execute function as soon as component IS mounted.
  useEffect(() => {
    // annonymus async function to wrap useAffect in (to make it async)
    (async () => {
      // Get items form local api route.
      const response = await fetch("api/product")
      const products = await response.json();
      setProducts(products);
    // Must be immeidatly invoked () behind fucntion.
    })();
    // getProducts().then((products) => setProducts(products)); // elaborative syntax method.
  // the empty array is the dependencies array, if empty it will only be executed once.
  }, []);

  console.log("[HomePage] render: ", products);
  return (
    <>
      <Head>
        <title>nextjs tim shop</title>
        <meta name="description" content="Generated by create next app" />
        {/* specifically mention from where the favicon should be loaded from relative from the public folder. */}
        <link rel="icon" href="/icons/favicon.ico" />
      </Head>
      <main className="homepage">
        <Title>NextJS tim shop <Link href="https://nextjs.org">Next.js!</Link></Title>
        <ul>
          {/* A foreach using map (mapping items into HTML outputs) */}
          {products.map((products) => (
            // Every react component needs a key.
            <li key={products.id}>
              {products.title}
            </li>
          ))}
          
        </ul>
      </main>
    </>
  )
}
